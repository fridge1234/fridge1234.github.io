"use strict";(self.webpackChunkouterspace_webpack=self.webpackChunkouterspace_webpack||[]).push([[2],{8277:(e,t,r)=>{r.d(t,{o:()=>h});var i=r(1661),n=r(6454),s=r(6724),a=r(1621),o=r(6682),l=r(4302),u=r(2496),d=r(3882);class h extends l.d{constructor(e,t,r){Number.isInteger(t)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),t=r),super(e,e,t),t=t||{},this.texture=new d.B(void 0,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:i.wem,this.texture._needsFlipEnvMap=!1}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.format=i.wk1,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const r={uniforms:{tEquirect:{value:null}},vertexShader:"varying vec3 vWorldDirection;vec3 transformDirection(in vec3 dir,in mat4 matrix){return normalize((matrix*vec4(dir,0.0)).xyz);}void main(){vWorldDirection=transformDirection(position,modelMatrix);\n#include <begin_vertex>\n#include <project_vertex>\n}",fragmentShader:"uniform sampler2D tEquirect;varying vec3 vWorldDirection;\n#include <common>\nvoid main(){vec3 direction=normalize(vWorldDirection);vec2 sampleUV=equirectUv(direction);gl_FragColor=texture2D(tEquirect,sampleUV);}"},l=new s.D(5,5,5),d=new a.j({name:"CubemapFromEquirect",uniforms:(0,o.dw)(r.uniforms),vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,side:i._Li,blending:i.jFi});d.uniforms.tEquirect.value=t;const h=new n.K(l,d),p=t.minFilter;t.minFilter===i.D1R&&(t.minFilter=i.wem);return new u._(1,10,this).update(e,h),t.minFilter=p,h.geometry.dispose(),h.material.dispose(),this}clear(e,t,r,i){const n=e.getRenderTarget();for(let n=0;n<6;n++)e.setRenderTarget(this,n),e.clear(t,r,i);e.setRenderTarget(n)}}h.prototype.isWebGLCubeRenderTarget=!0},8449:(e,t,r)=>{r.d(t,{p:()=>n});var i=r(4302);class n extends i.d{constructor(e,t,r={}){super(e,t,r),this.samples=4,this.ignoreDepthForMultisampleCopy=void 0===r.ignoreDepth||r.ignoreDepth,this.useRenderToTexture=void 0!==r.useRenderToTexture&&r.useRenderToTexture,this.useRenderbuffer=!1===this.useRenderToTexture}copy(e){return super.copy.call(this,e),this.samples=e.samples,this.useRenderToTexture=e.useRenderToTexture,this.useRenderbuffer=e.useRenderbuffer,this}}n.prototype.isWebGLMultisampleRenderTarget=!0},4302:(e,t,r)=>{r.d(t,{d:()=>o});var i=r(7406),n=r(4467),s=r(1661),a=r(223);class o extends i.p{constructor(e,t,r={}){super(),this.width=e,this.height=t,this.depth=1,this.scissor=new a.L(0,0,e,t),this.scissorTest=!1,this.viewport=new a.L(0,0,e,t),this.texture=new n.x(void 0,r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.encoding),this.texture.isRenderTargetTexture=!0,this.texture.image={width:e,height:t,depth:1},this.texture.generateMipmaps=void 0!==r.generateMipmaps&&r.generateMipmaps,this.texture.internalFormat=void 0!==r.internalFormat?r.internalFormat:null,this.texture.minFilter=void 0!==r.minFilter?r.minFilter:s.wem,this.depthBuffer=void 0===r.depthBuffer||r.depthBuffer,this.stencilBuffer=void 0!==r.stencilBuffer&&r.stencilBuffer,this.depthTexture=void 0!==r.depthTexture?r.depthTexture:null}setTexture(e){e.image={width:this.width,height:this.height,depth:this.depth},this.texture=e}setSize(e,t,r=1){this.width===e&&this.height===t&&this.depth===r||(this.width=e,this.height=t,this.depth=r,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=r,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.image={...this.texture.image},this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this}dispose(){this.dispatchEvent({type:"dispose"})}}o.prototype.isWebGLRenderTarget=!0},9274:(e,t,r)=>{r.d(t,{C:()=>V});var i=r(1661),n=r(4698),s=r(9203),a=r(6881),o=r(223),l=r(924),u=r(343),d=r(7263),h=r(8498),p=r(6355),c=r(4542),g=r(886),f=r(3886),m=r(8198),x=r(4959),w=r(5007),v=r(907),T=r(2304),M=r(6738),b=r(8449),S=r(4469),L=r(5502),y=r(7905),R=r(6423),E=r(9801),_=r(4302),C=r(5116),D=r(181),W=r(1643),P=r(1895),F=r(9627),A=r(3245),B=r(2504),G=r(392);function V(e={}){const t=void 0!==e.canvas?e.canvas:function(){const e=(0,G.c)("canvas");return e.style.display="block",e}(),r=void 0!==e.context?e.context:null,V=void 0!==e.alpha&&e.alpha,U=void 0===e.depth||e.depth,I=void 0===e.stencil||e.stencil,k=void 0!==e.antialias&&e.antialias,z=void 0===e.premultipliedAlpha||e.premultipliedAlpha,H=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,O=void 0!==e.powerPreference?e.powerPreference:"default",j=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat;let q=null,N=null;const Y=[],Z=[];this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=i.rnI,this.physicallyCorrectLights=!1,this.toneMapping=i.uL9,this.toneMappingExposure=1;const K=this;let X=!1,J=0,Q=0,$=null,ee=-1,te=null;const re=new o.L,ie=new o.L;let ne=null,se=t.width,ae=t.height,oe=1,le=null,ue=null;const de=new o.L(0,0,se,ae),he=new o.L(0,0,se,ae);let pe=!1;const ce=[],ge=new n.i;let fe=!1,me=!1,xe=null;const we=new s.y,ve=new a.P,Te={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function Me(){return null===$?oe:1}let be,Se,Le,ye,Re,Ee,_e,Ce,De,We,Pe,Fe,Ae,Be,Ge,Ve,Ue,Ie,ke,ze,He,Oe,je,qe=r;function Ne(e,r){for(let i=0;i<e.length;i++){const n=e[i],s=t.getContext(n,r);if(null!==s)return s}return null}try{const e={alpha:V,depth:U,stencil:I,antialias:k,premultipliedAlpha:z,preserveDrawingBuffer:H,powerPreference:O,failIfMajorPerformanceCaveat:j};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${i.UZH}`),t.addEventListener("webglcontextlost",Ke,!1),t.addEventListener("webglcontextrestored",Xe,!1),null===qe){const t=["webgl2","webgl","experimental-webgl"];if(!0===K.isWebGL1Renderer&&t.shift(),qe=Ne(t,e),null===qe)throw Ne(t)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===qe.getShaderPrecisionFormat&&(qe.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){throw console.error("THREE.WebGLRenderer: "+e.message),e}function Ye(){be=new x.P(qe),Se=new c.G(qe,be,e),be.init(Se),Oe=new F.f(qe,be,Se),Le=new D.m(qe,be,Se),ce[0]=1029,ye=new T.I(qe),Re=new y.Z,Ee=new W.w(qe,be,Le,Re,Se,Oe,ye),_e=new f.S(K),Ce=new m.W(K),De=new u.b(qe,Se),je=new h.s(qe,be,De,Se),We=new w.Y(qe,De,ye,je),Pe=new S.E(qe,We,De,ye),ke=new M.i(qe,Se,Ee),Ve=new g.h(Re),Fe=new L.Z(K,_e,Ce,be,Se,je,Ve),Ae=new B.J(Re),Be=new R.M(Re),Ge=new E.Q(be,Se),Ie=new d.a(K,_e,Le,Pe,z),Ue=new C.c(K,Pe,Se),ze=new p.w(qe,be,ye,Se),He=new v.x(qe,be,ye,Se),ye.programs=Fe.programs,K.capabilities=Se,K.extensions=be,K.properties=Re,K.renderLists=Be,K.shadowMap=Ue,K.state=Le,K.info=ye}Ye();const Ze=new A.M(K,qe);function Ke(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),X=!0}function Xe(){console.log("THREE.WebGLRenderer: Context Restored."),X=!1;const e=ye.autoReset,t=Ue.enabled,r=Ue.autoUpdate,i=Ue.needsUpdate,n=Ue.type;Ye(),ye.autoReset=e,Ue.enabled=t,Ue.autoUpdate=r,Ue.needsUpdate=i,Ue.type=n}function Je(e){const t=e.target;t.removeEventListener("dispose",Je),function(e){(function(e){const t=Re.get(e).programs;void 0!==t&&t.forEach((function(e){Fe.releaseProgram(e)}))})(e),Re.remove(e)}(t)}this.xr=Ze,this.getContext=function(){return qe},this.getContextAttributes=function(){return qe.getContextAttributes()},this.forceContextLoss=function(){const e=be.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){const e=be.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return oe},this.setPixelRatio=function(e){void 0!==e&&(oe=e,this.setSize(se,ae,!1))},this.getSize=function(e){return e.set(se,ae)},this.setSize=function(e,r,i){Ze.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(se=e,ae=r,t.width=Math.floor(e*oe),t.height=Math.floor(r*oe),!1!==i&&(t.style.width=e+"px",t.style.height=r+"px"),this.setViewport(0,0,e,r))},this.getDrawingBufferSize=function(e){return e.set(se*oe,ae*oe).floor()},this.setDrawingBufferSize=function(e,r,i){se=e,ae=r,oe=i,t.width=Math.floor(e*i),t.height=Math.floor(r*i),this.setViewport(0,0,e,r)},this.getCurrentViewport=function(e){return e.copy(re)},this.getViewport=function(e){return e.copy(de)},this.setViewport=function(e,t,r,i){e.isVector4?de.set(e.x,e.y,e.z,e.w):de.set(e,t,r,i),Le.viewport(re.copy(de).multiplyScalar(oe).floor())},this.getScissor=function(e){return e.copy(he)},this.setScissor=function(e,t,r,i){e.isVector4?he.set(e.x,e.y,e.z,e.w):he.set(e,t,r,i),Le.scissor(ie.copy(he).multiplyScalar(oe).floor())},this.getScissorTest=function(){return pe},this.setScissorTest=function(e){Le.setScissorTest(pe=e)},this.setOpaqueSort=function(e){le=e},this.setTransparentSort=function(e){ue=e},this.getClearColor=function(e){return e.copy(Ie.getClearColor())},this.setClearColor=function(){Ie.setClearColor.apply(Ie,arguments)},this.getClearAlpha=function(){return Ie.getClearAlpha()},this.setClearAlpha=function(){Ie.setClearAlpha.apply(Ie,arguments)},this.clear=function(e,t,r){let i=0;(void 0===e||e)&&(i|=16384),(void 0===t||t)&&(i|=256),(void 0===r||r)&&(i|=1024),qe.clear(i)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",Ke,!1),t.removeEventListener("webglcontextrestored",Xe,!1),Be.dispose(),Ge.dispose(),Re.dispose(),_e.dispose(),Ce.dispose(),Pe.dispose(),je.dispose(),Ze.dispose(),Ze.removeEventListener("sessionstart",$e),Ze.removeEventListener("sessionend",et),xe&&(xe.dispose(),xe=null),tt.stop()},this.renderBufferDirect=function(e,t,r,i,n,s){null===t&&(t=Te);const a=n.isMesh&&n.matrixWorld.determinant()<0,o=function(e,t,r,i,n){!0!==t.isScene&&(t=Te);Ee.resetTextureUnits();const s=t.fog,a=i.isMeshStandardMaterial?t.environment:null,o=null===$?K.outputEncoding:$.texture.encoding,l=(i.isMeshStandardMaterial?Ce:_e).get(i.envMap||a),u=!0===i.vertexColors&&!!r.attributes.color&&4===r.attributes.color.itemSize,d=!!i.normalMap&&!!r.attributes.tangent,h=!!r.morphAttributes.position,p=!!r.morphAttributes.normal,c=r.morphAttributes.position?r.morphAttributes.position.length:0,g=Re.get(i),f=N.state.lights;if(!0===fe&&(!0===me||e!==te)){const t=e===te&&i.id===ee;Ve.setState(i,e,t)}let m=!1;i.version===g.__version?g.needsLights&&g.lightsStateVersion!==f.state.version||g.outputEncoding!==o||n.isInstancedMesh&&!1===g.instancing?m=!0:n.isInstancedMesh||!0!==g.instancing?n.isSkinnedMesh&&!1===g.skinning?m=!0:n.isSkinnedMesh||!0!==g.skinning?g.envMap!==l||i.fog&&g.fog!==s?m=!0:void 0===g.numClippingPlanes||g.numClippingPlanes===Ve.numPlanes&&g.numIntersection===Ve.numIntersection?(g.vertexAlphas!==u||g.vertexTangents!==d||g.morphTargets!==h||g.morphNormals!==p||!0===Se.isWebGL2&&g.morphTargetsCount!==c)&&(m=!0):m=!0:m=!0:m=!0:(m=!0,g.__version=i.version);let x=g.currentProgram;!0===m&&(x=at(i,t,n));let w=!1,v=!1,T=!1;const M=x.getUniforms(),b=g.uniforms;Le.useProgram(x.program)&&(w=!0,v=!0,T=!0);i.id!==ee&&(ee=i.id,v=!0);if(w||te!==e){if(M.setValue(qe,"projectionMatrix",e.projectionMatrix),Se.logarithmicDepthBuffer&&M.setValue(qe,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),te!==e&&(te=e,v=!0,T=!0),i.isShaderMaterial||i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshStandardMaterial||i.envMap){const t=M.map.cameraPosition;void 0!==t&&t.setValue(qe,ve.setFromMatrixPosition(e.matrixWorld))}(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial)&&M.setValue(qe,"isOrthographic",!0===e.isOrthographicCamera),(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial||i.isShadowMaterial||n.isSkinnedMesh)&&M.setValue(qe,"viewMatrix",e.matrixWorldInverse)}if(n.isSkinnedMesh){M.setOptional(qe,n,"bindMatrix"),M.setOptional(qe,n,"bindMatrixInverse");const e=n.skeleton;e&&(Se.floatVertexTextures?(null===e.boneTexture&&e.computeBoneTexture(),M.setValue(qe,"boneTexture",e.boneTexture,Ee),M.setValue(qe,"boneTextureSize",e.boneTextureSize)):M.setOptional(qe,e,"boneMatrices"))}!r||void 0===r.morphAttributes.position&&void 0===r.morphAttributes.normal||ke.update(n,r,i,x);(v||g.receiveShadow!==n.receiveShadow)&&(g.receiveShadow=n.receiveShadow,M.setValue(qe,"receiveShadow",n.receiveShadow));v&&(M.setValue(qe,"toneMappingExposure",K.toneMappingExposure),g.needsLights&&(L=T,(S=b).ambientLightColor.needsUpdate=L,S.lightProbe.needsUpdate=L,S.directionalLights.needsUpdate=L,S.directionalLightShadows.needsUpdate=L,S.pointLights.needsUpdate=L,S.pointLightShadows.needsUpdate=L,S.spotLights.needsUpdate=L,S.spotLightShadows.needsUpdate=L,S.rectAreaLights.needsUpdate=L,S.hemisphereLights.needsUpdate=L),s&&i.fog&&Ae.refreshFogUniforms(b,s),Ae.refreshMaterialUniforms(b,i,oe,ae,xe),P.y.upload(qe,g.uniformsList,b,Ee));var S,L;i.isShaderMaterial&&!0===i.uniformsNeedUpdate&&(P.y.upload(qe,g.uniformsList,b,Ee),i.uniformsNeedUpdate=!1);i.isSpriteMaterial&&M.setValue(qe,"center",n.center);return M.setValue(qe,"modelViewMatrix",n.modelViewMatrix),M.setValue(qe,"normalMatrix",n.normalMatrix),M.setValue(qe,"modelMatrix",n.matrixWorld),x}(e,t,r,i,n);Le.setMaterial(i,a);let l=r.index;const u=r.attributes.position;if(null===l){if(void 0===u||0===u.count)return}else if(0===l.count)return;let d,h=1;!0===i.wireframe&&(l=We.getWireframeAttribute(r),h=2),je.setup(n,i,o,r,l);let p=ze;null!==l&&(d=De.get(l),p=He,p.setIndex(d));const c=null!==l?l.count:u.count,g=r.drawRange.start*h,f=r.drawRange.count*h,m=null!==s?s.start*h:0,x=null!==s?s.count*h:1/0,w=Math.max(g,m),v=Math.min(c,g+f,m+x)-1,T=Math.max(0,v-w+1);if(0!==T){if(n.isMesh)!0===i.wireframe?(Le.setLineWidth(i.wireframeLinewidth*Me()),p.setMode(1)):p.setMode(4);else if(n.isLine){let e=i.linewidth;void 0===e&&(e=1),Le.setLineWidth(e*Me()),n.isLineSegments?p.setMode(1):n.isLineLoop?p.setMode(2):p.setMode(3)}else n.isPoints?p.setMode(0):n.isSprite&&p.setMode(4);if(n.isInstancedMesh)p.renderInstances(w,T,n.count);else if(r.isInstancedBufferGeometry){const e=Math.min(r.instanceCount,r._maxInstanceCount);p.renderInstances(w,T,e)}else p.render(w,T)}},this.compile=function(e,t){N=Ge.get(e),N.init(),Z.push(N),e.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(N.pushLight(e),e.castShadow&&N.pushShadow(e))})),N.setupLights(K.physicallyCorrectLights),e.traverse((function(t){const r=t.material;if(r)if(Array.isArray(r))for(let i=0;i<r.length;i++){at(r[i],e,t)}else at(r,e,t)})),Z.pop(),N=null};let Qe=null;function $e(){tt.stop()}function et(){tt.start()}const tt=new l.C;function rt(e,t,r,i){if(!1===e.visible)return;if(e.layers.test(t.layers))if(e.isGroup)r=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)N.pushLight(e),e.castShadow&&N.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||ge.intersectsSprite(e)){i&&ve.setFromMatrixPosition(e.matrixWorld).applyMatrix4(we);const t=Pe.update(e),n=e.material;n.visible&&q.push(e,t,n,r,ve.z,null)}}else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.frame!==ye.render.frame&&(e.skeleton.update(),e.skeleton.frame=ye.render.frame),!e.frustumCulled||ge.intersectsObject(e))){i&&ve.setFromMatrixPosition(e.matrixWorld).applyMatrix4(we);const t=Pe.update(e),n=e.material;if(Array.isArray(n)){const i=t.groups;for(let s=0,a=i.length;s<a;s++){const a=i[s],o=n[a.materialIndex];o&&o.visible&&q.push(e,t,o,r,ve.z,a)}}else n.visible&&q.push(e,t,n,r,ve.z,null)}const n=e.children;for(let e=0,s=n.length;e<s;e++)rt(n[e],t,r,i)}function it(e,t,r,n){const s=e.opaque,a=e.transmissive,o=e.transparent;N.setupLightsView(r),a.length>0&&function(e,t,r){if(null===xe){const e=!0===k&&!0===Se.isWebGL2?b.p:_.d;xe=new e(1024,1024,{generateMipmaps:!0,type:null!==Oe.convert(i.cLu)?i.cLu:i.ywz,minFilter:i.D1R,magFilter:i.TyD,wrapS:i.uWy,wrapT:i.uWy,useRenderToTexture:be.has("WEBGL_multisampled_render_to_texture")})}const n=K.getRenderTarget();K.setRenderTarget(xe),K.clear();const s=K.toneMapping;K.toneMapping=i.uL9,nt(e,t,r),K.toneMapping=s,Ee.updateMultisampleRenderTarget(xe),Ee.updateRenderTargetMipmap(xe),K.setRenderTarget(n)}(s,t,r),n&&Le.viewport(re.copy(n)),s.length>0&&nt(s,t,r),a.length>0&&nt(a,t,r),o.length>0&&nt(o,t,r)}function nt(e,t,r){const i=!0===t.isScene?t.overrideMaterial:null;for(let n=0,s=e.length;n<s;n++){const s=e[n],a=s.object,o=s.geometry,l=null===i?s.material:i,u=s.group;a.layers.test(r.layers)&&st(a,t,r,o,l,u)}}function st(e,t,r,n,s,a){e.onBeforeRender(K,t,r,n,s,a),e.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),s.onBeforeRender(K,t,r,n,e,a),!0===s.transparent&&s.side===i.ehD?(s.side=i._Li,s.needsUpdate=!0,K.renderBufferDirect(r,t,n,s,e,a),s.side=i.Wl3,s.needsUpdate=!0,K.renderBufferDirect(r,t,n,s,e,a),s.side=i.ehD):K.renderBufferDirect(r,t,n,s,e,a),e.onAfterRender(K,t,r,n,s,a)}function at(e,t,r){!0!==t.isScene&&(t=Te);const i=Re.get(e),n=N.state.lights,s=N.state.shadowsArray,a=n.state.version,o=Fe.getParameters(e,n.state,s,t,r),l=Fe.getProgramCacheKey(o);let u=i.programs;i.environment=e.isMeshStandardMaterial?t.environment:null,i.fog=t.fog,i.envMap=(e.isMeshStandardMaterial?Ce:_e).get(e.envMap||i.environment),void 0===u&&(e.addEventListener("dispose",Je),u=new Map,i.programs=u);let d=u.get(l);if(void 0!==d){if(i.currentProgram===d&&i.lightsStateVersion===a)return ot(e,o),d}else o.uniforms=Fe.getUniforms(e),e.onBuild(r,o,K),e.onBeforeCompile(o,K),d=Fe.acquireProgram(o,l),u.set(l,d),i.uniforms=o.uniforms;const h=i.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(h.clippingPlanes=Ve.uniform),ot(e,o),i.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),i.lightsStateVersion=a,i.needsLights&&(h.ambientLightColor.value=n.state.ambient,h.lightProbe.value=n.state.probe,h.directionalLights.value=n.state.directional,h.directionalLightShadows.value=n.state.directionalShadow,h.spotLights.value=n.state.spot,h.spotLightShadows.value=n.state.spotShadow,h.rectAreaLights.value=n.state.rectArea,h.ltc_1.value=n.state.rectAreaLTC1,h.ltc_2.value=n.state.rectAreaLTC2,h.pointLights.value=n.state.point,h.pointLightShadows.value=n.state.pointShadow,h.hemisphereLights.value=n.state.hemi,h.directionalShadowMap.value=n.state.directionalShadowMap,h.directionalShadowMatrix.value=n.state.directionalShadowMatrix,h.spotShadowMap.value=n.state.spotShadowMap,h.spotShadowMatrix.value=n.state.spotShadowMatrix,h.pointShadowMap.value=n.state.pointShadowMap,h.pointShadowMatrix.value=n.state.pointShadowMatrix);const p=d.getUniforms(),c=P.y.seqWithValue(p.seq,h);return i.currentProgram=d,i.uniformsList=c,d}function ot(e,t){const r=Re.get(e);r.outputEncoding=t.outputEncoding,r.instancing=t.instancing,r.skinning=t.skinning,r.morphTargets=t.morphTargets,r.morphNormals=t.morphNormals,r.morphTargetsCount=t.morphTargetsCount,r.numClippingPlanes=t.numClippingPlanes,r.numIntersection=t.numClipIntersection,r.vertexAlphas=t.vertexAlphas,r.vertexTangents=t.vertexTangents}tt.setAnimationLoop((function(e){Qe&&Qe(e)})),"undefined"!=typeof window&&tt.setContext(window),this.setAnimationLoop=function(e){Qe=e,Ze.setAnimationLoop(e),null===e?tt.stop():tt.start()},Ze.addEventListener("sessionstart",$e),Ze.addEventListener("sessionend",et),this.render=function(e,t){if(void 0!==t&&!0!==t.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===X)return;!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),!0===Ze.enabled&&!0===Ze.isPresenting&&(!0===Ze.cameraAutoUpdate&&Ze.updateCamera(t),t=Ze.getCamera()),!0===e.isScene&&e.onBeforeRender(K,e,t,$),N=Ge.get(e,Z.length),N.init(),Z.push(N),we.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),ge.setFromProjectionMatrix(we),me=this.localClippingEnabled,fe=Ve.init(this.clippingPlanes,me,t),q=Be.get(e,Y.length),q.init(),Y.push(q),rt(e,t,0,K.sortObjects),q.finish(),!0===K.sortObjects&&q.sort(le,ue),!0===fe&&Ve.beginShadows();const r=N.state.shadowsArray;if(Ue.render(r,e,t),!0===fe&&Ve.endShadows(),!0===this.info.autoReset&&this.info.reset(),Ie.render(q,e),N.setupLights(K.physicallyCorrectLights),t.isArrayCamera){const r=t.cameras;for(let t=0,i=r.length;t<i;t++){const i=r[t];it(q,e,i,i.viewport)}}else it(q,e,t);null!==$&&(Ee.updateMultisampleRenderTarget($),Ee.updateRenderTargetMipmap($)),!0===e.isScene&&e.onAfterRender(K,e,t),Le.buffers.depth.setTest(!0),Le.buffers.depth.setMask(!0),Le.buffers.color.setMask(!0),Le.setPolygonOffset(!1),je.resetDefaultState(),ee=-1,te=null,Z.pop(),N=Z.length>0?Z[Z.length-1]:null,Y.pop(),q=Y.length>0?Y[Y.length-1]:null},this.getActiveCubeFace=function(){return J},this.getActiveMipmapLevel=function(){return Q},this.getRenderTarget=function(){return $},this.setRenderTargetTextures=function(e,t,r){Re.get(e.texture).__webglTexture=t,Re.get(e.depthTexture).__webglTexture=r;const i=Re.get(e);i.__hasExternalTextures=!0,i.__hasExternalTextures&&(i.__autoAllocateDepthBuffer=void 0===r,i.__autoAllocateDepthBuffer||e.useRenderToTexture&&(console.warn("render-to-texture extension was disabled because an external texture was provided"),e.useRenderToTexture=!1,e.useRenderbuffer=!0))},this.setRenderTargetFramebuffer=function(e,t){const r=Re.get(e);r.__webglFramebuffer=t,r.__useDefaultFramebuffer=void 0===t},this.setRenderTarget=function(e,t=0,r=0){$=e,J=t,Q=r;let i=!0;if(e){const t=Re.get(e);void 0!==t.__useDefaultFramebuffer?(Le.bindFramebuffer(36160,null),i=!1):void 0===t.__webglFramebuffer?Ee.setupRenderTarget(e):t.__hasExternalTextures&&Ee.rebindTextures(e,Re.get(e.texture).__webglTexture,Re.get(e.depthTexture).__webglTexture)}let n=null,s=!1,a=!1;if(e){const r=e.texture;(r.isDataTexture3D||r.isDataTexture2DArray)&&(a=!0);const i=Re.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(n=i[t],s=!0):n=e.useRenderbuffer?Re.get(e).__webglMultisampledFramebuffer:i,re.copy(e.viewport),ie.copy(e.scissor),ne=e.scissorTest}else re.copy(de).multiplyScalar(oe).floor(),ie.copy(he).multiplyScalar(oe).floor(),ne=pe;if(Le.bindFramebuffer(36160,n)&&Se.drawBuffers&&i){let t=!1;if(e)if(e.isWebGLMultipleRenderTargets){const r=e.texture;if(ce.length!==r.length||36064!==ce[0]){for(let e=0,t=r.length;e<t;e++)ce[e]=36064+e;ce.length=r.length,t=!0}}else 1===ce.length&&36064===ce[0]||(ce[0]=36064,ce.length=1,t=!0);else 1===ce.length&&1029===ce[0]||(ce[0]=1029,ce.length=1,t=!0);t&&(Se.isWebGL2?qe.drawBuffers(ce):be.get("WEBGL_draw_buffers").drawBuffersWEBGL(ce))}if(Le.viewport(re),Le.scissor(ie),Le.setScissorTest(ne),s){const i=Re.get(e.texture);qe.framebufferTexture2D(36160,36064,34069+t,i.__webglTexture,r)}else if(a){const i=Re.get(e.texture),n=t||0;qe.framebufferTextureLayer(36160,36064,i.__webglTexture,r||0,n)}ee=-1},this.readRenderTargetPixels=function(e,t,r,n,s,a,o){if(!e||!e.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let l=Re.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==o&&(l=l[o]),l){Le.bindFramebuffer(36160,l);try{const o=e.texture,l=o.format,u=o.type;if(l!==i.wk1&&Oe.convert(l)!==qe.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const d=u===i.cLu&&(be.has("EXT_color_buffer_half_float")||Se.isWebGL2&&be.has("EXT_color_buffer_float"));if(!(u===i.ywz||Oe.convert(u)===qe.getParameter(35738)||u===i.VzW&&(Se.isWebGL2||be.has("OES_texture_float")||be.has("WEBGL_color_buffer_float"))||d))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===qe.checkFramebufferStatus(36160)?t>=0&&t<=e.width-n&&r>=0&&r<=e.height-s&&qe.readPixels(t,r,n,s,Oe.convert(l),Oe.convert(u),a):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{const e=null!==$?Re.get($).__webglFramebuffer:null;Le.bindFramebuffer(36160,e)}}},this.copyFramebufferToTexture=function(e,t,r=0){const i=Math.pow(2,-r),n=Math.floor(t.image.width*i),s=Math.floor(t.image.height*i);let a=Oe.convert(t.format);Se.isWebGL2&&(6407===a&&(a=32849),6408===a&&(a=32856)),Ee.setTexture2D(t,0),qe.copyTexImage2D(3553,r,a,e.x,e.y,n,s,0),Le.unbindTexture()},this.copyTextureToTexture=function(e,t,r,i=0){const n=t.image.width,s=t.image.height,a=Oe.convert(r.format),o=Oe.convert(r.type);Ee.setTexture2D(r,0),qe.pixelStorei(37440,r.flipY),qe.pixelStorei(37441,r.premultiplyAlpha),qe.pixelStorei(3317,r.unpackAlignment),t.isDataTexture?qe.texSubImage2D(3553,i,e.x,e.y,n,s,a,o,t.image.data):t.isCompressedTexture?qe.compressedTexSubImage2D(3553,i,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,a,t.mipmaps[0].data):qe.texSubImage2D(3553,i,e.x,e.y,a,o,t.image),0===i&&r.generateMipmaps&&qe.generateMipmap(3553),Le.unbindTexture()},this.copyTextureToTexture3D=function(e,t,r,i,n=0){if(K.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const s=e.max.x-e.min.x+1,a=e.max.y-e.min.y+1,o=e.max.z-e.min.z+1,l=Oe.convert(i.format),u=Oe.convert(i.type);let d;if(i.isDataTexture3D)Ee.setTexture3D(i,0),d=32879;else{if(!i.isDataTexture2DArray)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");Ee.setTexture2DArray(i,0),d=35866}qe.pixelStorei(37440,i.flipY),qe.pixelStorei(37441,i.premultiplyAlpha),qe.pixelStorei(3317,i.unpackAlignment);const h=qe.getParameter(3314),p=qe.getParameter(32878),c=qe.getParameter(3316),g=qe.getParameter(3315),f=qe.getParameter(32877),m=r.isCompressedTexture?r.mipmaps[0]:r.image;qe.pixelStorei(3314,m.width),qe.pixelStorei(32878,m.height),qe.pixelStorei(3316,e.min.x),qe.pixelStorei(3315,e.min.y),qe.pixelStorei(32877,e.min.z),r.isDataTexture||r.isDataTexture3D?qe.texSubImage3D(d,n,t.x,t.y,t.z,s,a,o,l,u,m.data):r.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),qe.compressedTexSubImage3D(d,n,t.x,t.y,t.z,s,a,o,l,m.data)):qe.texSubImage3D(d,n,t.x,t.y,t.z,s,a,o,l,u,m),qe.pixelStorei(3314,h),qe.pixelStorei(32878,p),qe.pixelStorei(3316,c),qe.pixelStorei(3315,g),qe.pixelStorei(32877,f),0===n&&i.generateMipmaps&&qe.generateMipmap(d),Le.unbindTexture()},this.initTexture=function(e){Ee.setTexture2D(e,0),Le.unbindTexture()},this.resetState=function(){J=0,Q=0,$=null,Le.reset(),je.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}V.prototype.isWebGLRenderer=!0}}]);