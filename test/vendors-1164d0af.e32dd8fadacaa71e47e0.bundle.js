"use strict";(self.webpackChunkouterspace_webpack=self.webpackChunkouterspace_webpack||[]).push([[395],{2010:(e,t,r)=>{r.d(t,{Z:()=>n});var i=r(6469);class n extends i.T{constructor(){super(),this.type="Group"}}n.prototype.isGroup=!0},6454:(e,t,r)=>{r.d(t,{K:()=>D});var i=r(6881),n=r(1138),s=r(4699),o=r(7540),a=r(9203),l=r(6469),u=r(8121),d=r(1661),h=r(6173),p=r(9046);const c=new a.y,f=new o.z,g=new s.a,m=new i.P,x=new i.P,w=new i.P,T=new i.P,v=new i.P,b=new i.P,M=new i.P,y=new i.P,S=new i.P,L=new n.F,R=new n.F,E=new n.F,_=new i.P,C=new i.P;class D extends l.T{constructor(e=new p.u,t=new h.v){super(),this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,r=Object.keys(t);if(r.length>0){const e=t[r[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,r=e.length;t<r;t++){const r=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=t}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(e,t){const r=this.geometry,i=this.material,n=this.matrixWorld;if(void 0===i)return;if(null===r.boundingSphere&&r.computeBoundingSphere(),g.copy(r.boundingSphere),g.applyMatrix4(n),!1===e.ray.intersectsSphere(g))return;if(c.copy(n).invert(),f.copy(e.ray).applyMatrix4(c),null!==r.boundingBox&&!1===f.intersectsBox(r.boundingBox))return;let s;if(r.isBufferGeometry){const n=r.index,o=r.attributes.position,a=r.morphAttributes.position,l=r.morphTargetsRelative,u=r.attributes.uv,d=r.attributes.uv2,h=r.groups,p=r.drawRange;if(null!==n)if(Array.isArray(i))for(let r=0,c=h.length;r<c;r++){const c=h[r],g=i[c.materialIndex];for(let r=Math.max(c.start,p.start),i=Math.min(n.count,Math.min(c.start+c.count,p.start+p.count));r<i;r+=3){const i=n.getX(r),h=n.getX(r+1),p=n.getX(r+2);s=A(this,g,e,f,o,a,l,u,d,i,h,p),s&&(s.faceIndex=Math.floor(r/3),s.face.materialIndex=c.materialIndex,t.push(s))}}else{for(let r=Math.max(0,p.start),h=Math.min(n.count,p.start+p.count);r<h;r+=3){const h=n.getX(r),p=n.getX(r+1),c=n.getX(r+2);s=A(this,i,e,f,o,a,l,u,d,h,p,c),s&&(s.faceIndex=Math.floor(r/3),t.push(s))}}else if(void 0!==o)if(Array.isArray(i))for(let r=0,n=h.length;r<n;r++){const n=h[r],c=i[n.materialIndex];for(let r=Math.max(n.start,p.start),i=Math.min(o.count,Math.min(n.start+n.count,p.start+p.count));r<i;r+=3){s=A(this,c,e,f,o,a,l,u,d,r,r+1,r+2),s&&(s.faceIndex=Math.floor(r/3),s.face.materialIndex=n.materialIndex,t.push(s))}}else{for(let r=Math.max(0,p.start),n=Math.min(o.count,p.start+p.count);r<n;r+=3){s=A(this,i,e,f,o,a,l,u,d,r,r+1,r+2),s&&(s.faceIndex=Math.floor(r/3),t.push(s))}}}else r.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}function A(e,t,r,s,o,a,l,h,p,c,f,g){m.fromBufferAttribute(o,c),x.fromBufferAttribute(o,f),w.fromBufferAttribute(o,g);const D=e.morphTargetInfluences;if(a&&D){M.set(0,0,0),y.set(0,0,0),S.set(0,0,0);for(let e=0,t=a.length;e<t;e++){const t=D[e],r=a[e];0!==t&&(T.fromBufferAttribute(r,c),v.fromBufferAttribute(r,f),b.fromBufferAttribute(r,g),l?(M.addScaledVector(T,t),y.addScaledVector(v,t),S.addScaledVector(b,t)):(M.addScaledVector(T.sub(m),t),y.addScaledVector(v.sub(x),t),S.addScaledVector(b.sub(w),t)))}m.add(M),x.add(y),w.add(S)}e.isSkinnedMesh&&(e.boneTransform(c,m),e.boneTransform(f,x),e.boneTransform(g,w));const A=function(e,t,r,i,n,s,o,a){let l;if(l=t.side===d._Li?i.intersectTriangle(o,s,n,!0,a):i.intersectTriangle(n,s,o,t.side!==d.ehD,a),null===l)return null;C.copy(a),C.applyMatrix4(e.matrixWorld);const u=r.ray.origin.distanceTo(C);return u<r.near||u>r.far?null:{distance:u,point:C.clone(),object:e}}(e,t,r,s,m,x,w,_);if(A){h&&(L.fromBufferAttribute(h,c),R.fromBufferAttribute(h,f),E.fromBufferAttribute(h,g),A.uv=u.C.getUV(_,m,x,w,L,R,E,new n.F)),p&&(L.fromBufferAttribute(p,c),R.fromBufferAttribute(p,f),E.fromBufferAttribute(p,g),A.uv2=u.C.getUV(_,m,x,w,L,R,E,new n.F));const e={a:c,b:f,c:g,normal:new i.P,materialIndex:0};u.C.getNormal(m,x,w,e.normal),A.face=e}return A}D.prototype.isMesh=!0},8277:(e,t,r)=>{r.d(t,{o:()=>h});var i=r(1661),n=r(6454),s=r(6724),o=r(1621),a=r(6682),l=r(4302),u=r(2496),d=r(3882);class h extends l.d{constructor(e,t,r){Number.isInteger(t)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),t=r),super(e,e,t),t=t||{},this.texture=new d.B(void 0,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:i.wem,this.texture._needsFlipEnvMap=!1}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.format=i.wk1,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const r={uniforms:{tEquirect:{value:null}},vertexShader:"varying vec3 vWorldDirection;vec3 transformDirection(in vec3 dir,in mat4 matrix){return normalize((matrix*vec4(dir,0.0)).xyz);}void main(){vWorldDirection=transformDirection(position,modelMatrix);\n#include <begin_vertex>\n#include <project_vertex>\n}",fragmentShader:"uniform sampler2D tEquirect;varying vec3 vWorldDirection;\n#include <common>\nvoid main(){vec3 direction=normalize(vWorldDirection);vec2 sampleUV=equirectUv(direction);gl_FragColor=texture2D(tEquirect,sampleUV);}"},l=new s.D(5,5,5),d=new o.j({name:"CubemapFromEquirect",uniforms:(0,a.dw)(r.uniforms),vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,side:i._Li,blending:i.jFi});d.uniforms.tEquirect.value=t;const h=new n.K(l,d),p=t.minFilter;t.minFilter===i.D1R&&(t.minFilter=i.wem);return new u._(1,10,this).update(e,h),t.minFilter=p,h.geometry.dispose(),h.material.dispose(),this}clear(e,t,r,i){const n=e.getRenderTarget();for(let n=0;n<6;n++)e.setRenderTarget(this,n),e.clear(t,r,i);e.setRenderTarget(n)}}h.prototype.isWebGLCubeRenderTarget=!0},8449:(e,t,r)=>{r.d(t,{p:()=>n});var i=r(4302);class n extends i.d{constructor(e,t,r={}){super(e,t,r),this.samples=4,this.ignoreDepthForMultisampleCopy=void 0===r.ignoreDepth||r.ignoreDepth,this.useRenderToTexture=void 0!==r.useRenderToTexture&&r.useRenderToTexture,this.useRenderbuffer=!1===this.useRenderToTexture}copy(e){return super.copy.call(this,e),this.samples=e.samples,this.useRenderToTexture=e.useRenderToTexture,this.useRenderbuffer=e.useRenderbuffer,this}}n.prototype.isWebGLMultisampleRenderTarget=!0},4302:(e,t,r)=>{r.d(t,{d:()=>a});var i=r(7406),n=r(4467),s=r(1661),o=r(223);class a extends i.p{constructor(e,t,r={}){super(),this.width=e,this.height=t,this.depth=1,this.scissor=new o.L(0,0,e,t),this.scissorTest=!1,this.viewport=new o.L(0,0,e,t),this.texture=new n.x(void 0,r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.encoding),this.texture.isRenderTargetTexture=!0,this.texture.image={width:e,height:t,depth:1},this.texture.generateMipmaps=void 0!==r.generateMipmaps&&r.generateMipmaps,this.texture.internalFormat=void 0!==r.internalFormat?r.internalFormat:null,this.texture.minFilter=void 0!==r.minFilter?r.minFilter:s.wem,this.depthBuffer=void 0===r.depthBuffer||r.depthBuffer,this.stencilBuffer=void 0!==r.stencilBuffer&&r.stencilBuffer,this.depthTexture=void 0!==r.depthTexture?r.depthTexture:null}setTexture(e){e.image={width:this.width,height:this.height,depth:this.depth},this.texture=e}setSize(e,t,r=1){this.width===e&&this.height===t&&this.depth===r||(this.width=e,this.height=t,this.depth=r,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=r,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.image={...this.texture.image},this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this}dispose(){this.dispatchEvent({type:"dispose"})}}a.prototype.isWebGLRenderTarget=!0},9274:(e,t,r)=>{r.d(t,{C:()=>I});var i=r(1661),n=r(4698),s=r(9203),o=r(6881),a=r(223),l=r(924),u=r(343),d=r(7263),h=r(8498),p=r(6355),c=r(4542),f=r(886),g=r(3886),m=r(8198),x=r(4959),w=r(5007),T=r(907),v=r(2304),b=r(6738),M=r(8449),y=r(4469),S=r(5502),L=r(7905),R=r(6423),E=r(9801),_=r(4302),C=r(5116),D=r(181),A=r(1643),P=r(1895),W=r(9627),B=r(7761),F=r(2504),G=r(392);function I(e={}){const t=void 0!==e.canvas?e.canvas:function(){const e=(0,G.c)("canvas");return e.style.display="block",e}(),r=void 0!==e.context?e.context:null,I=void 0!==e.alpha&&e.alpha,V=void 0===e.depth||e.depth,U=void 0===e.stencil||e.stencil,k=void 0!==e.antialias&&e.antialias,z=void 0===e.premultipliedAlpha||e.premultipliedAlpha,H=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,O=void 0!==e.powerPreference?e.powerPreference:"default",j=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat;let q=null,N=null;const X=[],Z=[];this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=i.rnI,this.physicallyCorrectLights=!1,this.toneMapping=i.uL9,this.toneMappingExposure=1;const K=this;let Y=!1,J=0,Q=0,$=null,ee=-1,te=null;const re=new a.L,ie=new a.L;let ne=null,se=t.width,oe=t.height,ae=1,le=null,ue=null;const de=new a.L(0,0,se,oe),he=new a.L(0,0,se,oe);let pe=!1;const ce=[],fe=new n.i;let ge=!1,me=!1,xe=null;const we=new s.y,Te=new o.P,ve={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function be(){return null===$?ae:1}let Me,ye,Se,Le,Re,Ee,_e,Ce,De,Ae,Pe,We,Be,Fe,Ge,Ie,Ve,Ue,ke,ze,He,Oe,je,qe=r;function Ne(e,r){for(let i=0;i<e.length;i++){const n=e[i],s=t.getContext(n,r);if(null!==s)return s}return null}try{const e={alpha:I,depth:V,stencil:U,antialias:k,premultipliedAlpha:z,preserveDrawingBuffer:H,powerPreference:O,failIfMajorPerformanceCaveat:j};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${i.UZH}`),t.addEventListener("webglcontextlost",Ke,!1),t.addEventListener("webglcontextrestored",Ye,!1),null===qe){const t=["webgl2","webgl","experimental-webgl"];if(!0===K.isWebGL1Renderer&&t.shift(),qe=Ne(t,e),null===qe)throw Ne(t)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===qe.getShaderPrecisionFormat&&(qe.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){throw console.error("THREE.WebGLRenderer: "+e.message),e}function Xe(){Me=new x.P(qe),ye=new c.G(qe,Me,e),Me.init(ye),Oe=new W.f(qe,Me,ye),Se=new D.m(qe,Me,ye),ce[0]=1029,Le=new v.I(qe),Re=new L.Z,Ee=new A.w(qe,Me,Se,Re,ye,Oe,Le),_e=new g.S(K),Ce=new m.W(K),De=new u.b(qe,ye),je=new h.s(qe,Me,De,ye),Ae=new w.Y(qe,De,Le,je),Pe=new y.E(qe,Ae,De,Le),ke=new b.i(qe,ye,Ee),Ie=new f.h(Re),We=new S.Z(K,_e,Ce,Me,ye,je,Ie),Be=new F.J(Re),Fe=new R.M(Re),Ge=new E.Q(Me,ye),Ue=new d.a(K,_e,Se,Pe,z),Ve=new C.c(K,Pe,ye),ze=new p.w(qe,Me,Le,ye),He=new T.x(qe,Me,Le,ye),Le.programs=We.programs,K.capabilities=ye,K.extensions=Me,K.properties=Re,K.renderLists=Fe,K.shadowMap=Ve,K.state=Se,K.info=Le}Xe();const Ze=new B.M(K,qe);function Ke(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),Y=!0}function Ye(){console.log("THREE.WebGLRenderer: Context Restored."),Y=!1;const e=Le.autoReset,t=Ve.enabled,r=Ve.autoUpdate,i=Ve.needsUpdate,n=Ve.type;Xe(),Le.autoReset=e,Ve.enabled=t,Ve.autoUpdate=r,Ve.needsUpdate=i,Ve.type=n}function Je(e){const t=e.target;t.removeEventListener("dispose",Je),function(e){(function(e){const t=Re.get(e).programs;void 0!==t&&t.forEach((function(e){We.releaseProgram(e)}))})(e),Re.remove(e)}(t)}this.xr=Ze,this.getContext=function(){return qe},this.getContextAttributes=function(){return qe.getContextAttributes()},this.forceContextLoss=function(){const e=Me.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){const e=Me.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return ae},this.setPixelRatio=function(e){void 0!==e&&(ae=e,this.setSize(se,oe,!1))},this.getSize=function(e){return e.set(se,oe)},this.setSize=function(e,r,i){Ze.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(se=e,oe=r,t.width=Math.floor(e*ae),t.height=Math.floor(r*ae),!1!==i&&(t.style.width=e+"px",t.style.height=r+"px"),this.setViewport(0,0,e,r))},this.getDrawingBufferSize=function(e){return e.set(se*ae,oe*ae).floor()},this.setDrawingBufferSize=function(e,r,i){se=e,oe=r,ae=i,t.width=Math.floor(e*i),t.height=Math.floor(r*i),this.setViewport(0,0,e,r)},this.getCurrentViewport=function(e){return e.copy(re)},this.getViewport=function(e){return e.copy(de)},this.setViewport=function(e,t,r,i){e.isVector4?de.set(e.x,e.y,e.z,e.w):de.set(e,t,r,i),Se.viewport(re.copy(de).multiplyScalar(ae).floor())},this.getScissor=function(e){return e.copy(he)},this.setScissor=function(e,t,r,i){e.isVector4?he.set(e.x,e.y,e.z,e.w):he.set(e,t,r,i),Se.scissor(ie.copy(he).multiplyScalar(ae).floor())},this.getScissorTest=function(){return pe},this.setScissorTest=function(e){Se.setScissorTest(pe=e)},this.setOpaqueSort=function(e){le=e},this.setTransparentSort=function(e){ue=e},this.getClearColor=function(e){return e.copy(Ue.getClearColor())},this.setClearColor=function(){Ue.setClearColor.apply(Ue,arguments)},this.getClearAlpha=function(){return Ue.getClearAlpha()},this.setClearAlpha=function(){Ue.setClearAlpha.apply(Ue,arguments)},this.clear=function(e,t,r){let i=0;(void 0===e||e)&&(i|=16384),(void 0===t||t)&&(i|=256),(void 0===r||r)&&(i|=1024),qe.clear(i)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",Ke,!1),t.removeEventListener("webglcontextrestored",Ye,!1),Fe.dispose(),Ge.dispose(),Re.dispose(),_e.dispose(),Ce.dispose(),Pe.dispose(),je.dispose(),Ze.dispose(),Ze.removeEventListener("sessionstart",$e),Ze.removeEventListener("sessionend",et),xe&&(xe.dispose(),xe=null),tt.stop()},this.renderBufferDirect=function(e,t,r,i,n,s){null===t&&(t=ve);const o=n.isMesh&&n.matrixWorld.determinant()<0,a=function(e,t,r,i,n){!0!==t.isScene&&(t=ve);Ee.resetTextureUnits();const s=t.fog,o=i.isMeshStandardMaterial?t.environment:null,a=null===$?K.outputEncoding:$.texture.encoding,l=(i.isMeshStandardMaterial?Ce:_e).get(i.envMap||o),u=!0===i.vertexColors&&!!r.attributes.color&&4===r.attributes.color.itemSize,d=!!i.normalMap&&!!r.attributes.tangent,h=!!r.morphAttributes.position,p=!!r.morphAttributes.normal,c=r.morphAttributes.position?r.morphAttributes.position.length:0,f=Re.get(i),g=N.state.lights;if(!0===ge&&(!0===me||e!==te)){const t=e===te&&i.id===ee;Ie.setState(i,e,t)}let m=!1;i.version===f.__version?f.needsLights&&f.lightsStateVersion!==g.state.version||f.outputEncoding!==a||n.isInstancedMesh&&!1===f.instancing?m=!0:n.isInstancedMesh||!0!==f.instancing?n.isSkinnedMesh&&!1===f.skinning?m=!0:n.isSkinnedMesh||!0!==f.skinning?f.envMap!==l||i.fog&&f.fog!==s?m=!0:void 0===f.numClippingPlanes||f.numClippingPlanes===Ie.numPlanes&&f.numIntersection===Ie.numIntersection?(f.vertexAlphas!==u||f.vertexTangents!==d||f.morphTargets!==h||f.morphNormals!==p||!0===ye.isWebGL2&&f.morphTargetsCount!==c)&&(m=!0):m=!0:m=!0:m=!0:(m=!0,f.__version=i.version);let x=f.currentProgram;!0===m&&(x=ot(i,t,n));let w=!1,T=!1,v=!1;const b=x.getUniforms(),M=f.uniforms;Se.useProgram(x.program)&&(w=!0,T=!0,v=!0);i.id!==ee&&(ee=i.id,T=!0);if(w||te!==e){if(b.setValue(qe,"projectionMatrix",e.projectionMatrix),ye.logarithmicDepthBuffer&&b.setValue(qe,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),te!==e&&(te=e,T=!0,v=!0),i.isShaderMaterial||i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshStandardMaterial||i.envMap){const t=b.map.cameraPosition;void 0!==t&&t.setValue(qe,Te.setFromMatrixPosition(e.matrixWorld))}(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial)&&b.setValue(qe,"isOrthographic",!0===e.isOrthographicCamera),(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial||i.isShadowMaterial||n.isSkinnedMesh)&&b.setValue(qe,"viewMatrix",e.matrixWorldInverse)}if(n.isSkinnedMesh){b.setOptional(qe,n,"bindMatrix"),b.setOptional(qe,n,"bindMatrixInverse");const e=n.skeleton;e&&(ye.floatVertexTextures?(null===e.boneTexture&&e.computeBoneTexture(),b.setValue(qe,"boneTexture",e.boneTexture,Ee),b.setValue(qe,"boneTextureSize",e.boneTextureSize)):b.setOptional(qe,e,"boneMatrices"))}!r||void 0===r.morphAttributes.position&&void 0===r.morphAttributes.normal||ke.update(n,r,i,x);(T||f.receiveShadow!==n.receiveShadow)&&(f.receiveShadow=n.receiveShadow,b.setValue(qe,"receiveShadow",n.receiveShadow));T&&(b.setValue(qe,"toneMappingExposure",K.toneMappingExposure),f.needsLights&&(S=v,(y=M).ambientLightColor.needsUpdate=S,y.lightProbe.needsUpdate=S,y.directionalLights.needsUpdate=S,y.directionalLightShadows.needsUpdate=S,y.pointLights.needsUpdate=S,y.pointLightShadows.needsUpdate=S,y.spotLights.needsUpdate=S,y.spotLightShadows.needsUpdate=S,y.rectAreaLights.needsUpdate=S,y.hemisphereLights.needsUpdate=S),s&&i.fog&&Be.refreshFogUniforms(M,s),Be.refreshMaterialUniforms(M,i,ae,oe,xe),P.y.upload(qe,f.uniformsList,M,Ee));var y,S;i.isShaderMaterial&&!0===i.uniformsNeedUpdate&&(P.y.upload(qe,f.uniformsList,M,Ee),i.uniformsNeedUpdate=!1);i.isSpriteMaterial&&b.setValue(qe,"center",n.center);return b.setValue(qe,"modelViewMatrix",n.modelViewMatrix),b.setValue(qe,"normalMatrix",n.normalMatrix),b.setValue(qe,"modelMatrix",n.matrixWorld),x}(e,t,r,i,n);Se.setMaterial(i,o);let l=r.index;const u=r.attributes.position;if(null===l){if(void 0===u||0===u.count)return}else if(0===l.count)return;let d,h=1;!0===i.wireframe&&(l=Ae.getWireframeAttribute(r),h=2),je.setup(n,i,a,r,l);let p=ze;null!==l&&(d=De.get(l),p=He,p.setIndex(d));const c=null!==l?l.count:u.count,f=r.drawRange.start*h,g=r.drawRange.count*h,m=null!==s?s.start*h:0,x=null!==s?s.count*h:1/0,w=Math.max(f,m),T=Math.min(c,f+g,m+x)-1,v=Math.max(0,T-w+1);if(0!==v){if(n.isMesh)!0===i.wireframe?(Se.setLineWidth(i.wireframeLinewidth*be()),p.setMode(1)):p.setMode(4);else if(n.isLine){let e=i.linewidth;void 0===e&&(e=1),Se.setLineWidth(e*be()),n.isLineSegments?p.setMode(1):n.isLineLoop?p.setMode(2):p.setMode(3)}else n.isPoints?p.setMode(0):n.isSprite&&p.setMode(4);if(n.isInstancedMesh)p.renderInstances(w,v,n.count);else if(r.isInstancedBufferGeometry){const e=Math.min(r.instanceCount,r._maxInstanceCount);p.renderInstances(w,v,e)}else p.render(w,v)}},this.compile=function(e,t){N=Ge.get(e),N.init(),Z.push(N),e.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(N.pushLight(e),e.castShadow&&N.pushShadow(e))})),N.setupLights(K.physicallyCorrectLights),e.traverse((function(t){const r=t.material;if(r)if(Array.isArray(r))for(let i=0;i<r.length;i++){ot(r[i],e,t)}else ot(r,e,t)})),Z.pop(),N=null};let Qe=null;function $e(){tt.stop()}function et(){tt.start()}const tt=new l.C;function rt(e,t,r,i){if(!1===e.visible)return;if(e.layers.test(t.layers))if(e.isGroup)r=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)N.pushLight(e),e.castShadow&&N.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||fe.intersectsSprite(e)){i&&Te.setFromMatrixPosition(e.matrixWorld).applyMatrix4(we);const t=Pe.update(e),n=e.material;n.visible&&q.push(e,t,n,r,Te.z,null)}}else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.frame!==Le.render.frame&&(e.skeleton.update(),e.skeleton.frame=Le.render.frame),!e.frustumCulled||fe.intersectsObject(e))){i&&Te.setFromMatrixPosition(e.matrixWorld).applyMatrix4(we);const t=Pe.update(e),n=e.material;if(Array.isArray(n)){const i=t.groups;for(let s=0,o=i.length;s<o;s++){const o=i[s],a=n[o.materialIndex];a&&a.visible&&q.push(e,t,a,r,Te.z,o)}}else n.visible&&q.push(e,t,n,r,Te.z,null)}const n=e.children;for(let e=0,s=n.length;e<s;e++)rt(n[e],t,r,i)}function it(e,t,r,n){const s=e.opaque,o=e.transmissive,a=e.transparent;N.setupLightsView(r),o.length>0&&function(e,t,r){if(null===xe){const e=!0===k&&!0===ye.isWebGL2?M.p:_.d;xe=new e(1024,1024,{generateMipmaps:!0,type:null!==Oe.convert(i.cLu)?i.cLu:i.ywz,minFilter:i.D1R,magFilter:i.TyD,wrapS:i.uWy,wrapT:i.uWy,useRenderToTexture:Me.has("WEBGL_multisampled_render_to_texture")})}const n=K.getRenderTarget();K.setRenderTarget(xe),K.clear();const s=K.toneMapping;K.toneMapping=i.uL9,nt(e,t,r),K.toneMapping=s,Ee.updateMultisampleRenderTarget(xe),Ee.updateRenderTargetMipmap(xe),K.setRenderTarget(n)}(s,t,r),n&&Se.viewport(re.copy(n)),s.length>0&&nt(s,t,r),o.length>0&&nt(o,t,r),a.length>0&&nt(a,t,r)}function nt(e,t,r){const i=!0===t.isScene?t.overrideMaterial:null;for(let n=0,s=e.length;n<s;n++){const s=e[n],o=s.object,a=s.geometry,l=null===i?s.material:i,u=s.group;o.layers.test(r.layers)&&st(o,t,r,a,l,u)}}function st(e,t,r,n,s,o){e.onBeforeRender(K,t,r,n,s,o),e.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),s.onBeforeRender(K,t,r,n,e,o),!0===s.transparent&&s.side===i.ehD?(s.side=i._Li,s.needsUpdate=!0,K.renderBufferDirect(r,t,n,s,e,o),s.side=i.Wl3,s.needsUpdate=!0,K.renderBufferDirect(r,t,n,s,e,o),s.side=i.ehD):K.renderBufferDirect(r,t,n,s,e,o),e.onAfterRender(K,t,r,n,s,o)}function ot(e,t,r){!0!==t.isScene&&(t=ve);const i=Re.get(e),n=N.state.lights,s=N.state.shadowsArray,o=n.state.version,a=We.getParameters(e,n.state,s,t,r),l=We.getProgramCacheKey(a);let u=i.programs;i.environment=e.isMeshStandardMaterial?t.environment:null,i.fog=t.fog,i.envMap=(e.isMeshStandardMaterial?Ce:_e).get(e.envMap||i.environment),void 0===u&&(e.addEventListener("dispose",Je),u=new Map,i.programs=u);let d=u.get(l);if(void 0!==d){if(i.currentProgram===d&&i.lightsStateVersion===o)return at(e,a),d}else a.uniforms=We.getUniforms(e),e.onBuild(r,a,K),e.onBeforeCompile(a,K),d=We.acquireProgram(a,l),u.set(l,d),i.uniforms=a.uniforms;const h=i.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(h.clippingPlanes=Ie.uniform),at(e,a),i.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),i.lightsStateVersion=o,i.needsLights&&(h.ambientLightColor.value=n.state.ambient,h.lightProbe.value=n.state.probe,h.directionalLights.value=n.state.directional,h.directionalLightShadows.value=n.state.directionalShadow,h.spotLights.value=n.state.spot,h.spotLightShadows.value=n.state.spotShadow,h.rectAreaLights.value=n.state.rectArea,h.ltc_1.value=n.state.rectAreaLTC1,h.ltc_2.value=n.state.rectAreaLTC2,h.pointLights.value=n.state.point,h.pointLightShadows.value=n.state.pointShadow,h.hemisphereLights.value=n.state.hemi,h.directionalShadowMap.value=n.state.directionalShadowMap,h.directionalShadowMatrix.value=n.state.directionalShadowMatrix,h.spotShadowMap.value=n.state.spotShadowMap,h.spotShadowMatrix.value=n.state.spotShadowMatrix,h.pointShadowMap.value=n.state.pointShadowMap,h.pointShadowMatrix.value=n.state.pointShadowMatrix);const p=d.getUniforms(),c=P.y.seqWithValue(p.seq,h);return i.currentProgram=d,i.uniformsList=c,d}function at(e,t){const r=Re.get(e);r.outputEncoding=t.outputEncoding,r.instancing=t.instancing,r.skinning=t.skinning,r.morphTargets=t.morphTargets,r.morphNormals=t.morphNormals,r.morphTargetsCount=t.morphTargetsCount,r.numClippingPlanes=t.numClippingPlanes,r.numIntersection=t.numClipIntersection,r.vertexAlphas=t.vertexAlphas,r.vertexTangents=t.vertexTangents}tt.setAnimationLoop((function(e){Qe&&Qe(e)})),"undefined"!=typeof window&&tt.setContext(window),this.setAnimationLoop=function(e){Qe=e,Ze.setAnimationLoop(e),null===e?tt.stop():tt.start()},Ze.addEventListener("sessionstart",$e),Ze.addEventListener("sessionend",et),this.render=function(e,t){if(void 0!==t&&!0!==t.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===Y)return;!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),!0===Ze.enabled&&!0===Ze.isPresenting&&(!0===Ze.cameraAutoUpdate&&Ze.updateCamera(t),t=Ze.getCamera()),!0===e.isScene&&e.onBeforeRender(K,e,t,$),N=Ge.get(e,Z.length),N.init(),Z.push(N),we.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),fe.setFromProjectionMatrix(we),me=this.localClippingEnabled,ge=Ie.init(this.clippingPlanes,me,t),q=Fe.get(e,X.length),q.init(),X.push(q),rt(e,t,0,K.sortObjects),q.finish(),!0===K.sortObjects&&q.sort(le,ue),!0===ge&&Ie.beginShadows();const r=N.state.shadowsArray;if(Ve.render(r,e,t),!0===ge&&Ie.endShadows(),!0===this.info.autoReset&&this.info.reset(),Ue.render(q,e),N.setupLights(K.physicallyCorrectLights),t.isArrayCamera){const r=t.cameras;for(let t=0,i=r.length;t<i;t++){const i=r[t];it(q,e,i,i.viewport)}}else it(q,e,t);null!==$&&(Ee.updateMultisampleRenderTarget($),Ee.updateRenderTargetMipmap($)),!0===e.isScene&&e.onAfterRender(K,e,t),Se.buffers.depth.setTest(!0),Se.buffers.depth.setMask(!0),Se.buffers.color.setMask(!0),Se.setPolygonOffset(!1),je.resetDefaultState(),ee=-1,te=null,Z.pop(),N=Z.length>0?Z[Z.length-1]:null,X.pop(),q=X.length>0?X[X.length-1]:null},this.getActiveCubeFace=function(){return J},this.getActiveMipmapLevel=function(){return Q},this.getRenderTarget=function(){return $},this.setRenderTargetTextures=function(e,t,r){Re.get(e.texture).__webglTexture=t,Re.get(e.depthTexture).__webglTexture=r;const i=Re.get(e);i.__hasExternalTextures=!0,i.__hasExternalTextures&&(i.__autoAllocateDepthBuffer=void 0===r,i.__autoAllocateDepthBuffer||e.useRenderToTexture&&(console.warn("render-to-texture extension was disabled because an external texture was provided"),e.useRenderToTexture=!1,e.useRenderbuffer=!0))},this.setRenderTargetFramebuffer=function(e,t){const r=Re.get(e);r.__webglFramebuffer=t,r.__useDefaultFramebuffer=void 0===t},this.setRenderTarget=function(e,t=0,r=0){$=e,J=t,Q=r;let i=!0;if(e){const t=Re.get(e);void 0!==t.__useDefaultFramebuffer?(Se.bindFramebuffer(36160,null),i=!1):void 0===t.__webglFramebuffer?Ee.setupRenderTarget(e):t.__hasExternalTextures&&Ee.rebindTextures(e,Re.get(e.texture).__webglTexture,Re.get(e.depthTexture).__webglTexture)}let n=null,s=!1,o=!1;if(e){const r=e.texture;(r.isDataTexture3D||r.isDataTexture2DArray)&&(o=!0);const i=Re.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(n=i[t],s=!0):n=e.useRenderbuffer?Re.get(e).__webglMultisampledFramebuffer:i,re.copy(e.viewport),ie.copy(e.scissor),ne=e.scissorTest}else re.copy(de).multiplyScalar(ae).floor(),ie.copy(he).multiplyScalar(ae).floor(),ne=pe;if(Se.bindFramebuffer(36160,n)&&ye.drawBuffers&&i){let t=!1;if(e)if(e.isWebGLMultipleRenderTargets){const r=e.texture;if(ce.length!==r.length||36064!==ce[0]){for(let e=0,t=r.length;e<t;e++)ce[e]=36064+e;ce.length=r.length,t=!0}}else 1===ce.length&&36064===ce[0]||(ce[0]=36064,ce.length=1,t=!0);else 1===ce.length&&1029===ce[0]||(ce[0]=1029,ce.length=1,t=!0);t&&(ye.isWebGL2?qe.drawBuffers(ce):Me.get("WEBGL_draw_buffers").drawBuffersWEBGL(ce))}if(Se.viewport(re),Se.scissor(ie),Se.setScissorTest(ne),s){const i=Re.get(e.texture);qe.framebufferTexture2D(36160,36064,34069+t,i.__webglTexture,r)}else if(o){const i=Re.get(e.texture),n=t||0;qe.framebufferTextureLayer(36160,36064,i.__webglTexture,r||0,n)}ee=-1},this.readRenderTargetPixels=function(e,t,r,n,s,o,a){if(!e||!e.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let l=Re.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==a&&(l=l[a]),l){Se.bindFramebuffer(36160,l);try{const a=e.texture,l=a.format,u=a.type;if(l!==i.wk1&&Oe.convert(l)!==qe.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const d=u===i.cLu&&(Me.has("EXT_color_buffer_half_float")||ye.isWebGL2&&Me.has("EXT_color_buffer_float"));if(!(u===i.ywz||Oe.convert(u)===qe.getParameter(35738)||u===i.VzW&&(ye.isWebGL2||Me.has("OES_texture_float")||Me.has("WEBGL_color_buffer_float"))||d))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===qe.checkFramebufferStatus(36160)?t>=0&&t<=e.width-n&&r>=0&&r<=e.height-s&&qe.readPixels(t,r,n,s,Oe.convert(l),Oe.convert(u),o):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{const e=null!==$?Re.get($).__webglFramebuffer:null;Se.bindFramebuffer(36160,e)}}},this.copyFramebufferToTexture=function(e,t,r=0){const i=Math.pow(2,-r),n=Math.floor(t.image.width*i),s=Math.floor(t.image.height*i);let o=Oe.convert(t.format);ye.isWebGL2&&(6407===o&&(o=32849),6408===o&&(o=32856)),Ee.setTexture2D(t,0),qe.copyTexImage2D(3553,r,o,e.x,e.y,n,s,0),Se.unbindTexture()},this.copyTextureToTexture=function(e,t,r,i=0){const n=t.image.width,s=t.image.height,o=Oe.convert(r.format),a=Oe.convert(r.type);Ee.setTexture2D(r,0),qe.pixelStorei(37440,r.flipY),qe.pixelStorei(37441,r.premultiplyAlpha),qe.pixelStorei(3317,r.unpackAlignment),t.isDataTexture?qe.texSubImage2D(3553,i,e.x,e.y,n,s,o,a,t.image.data):t.isCompressedTexture?qe.compressedTexSubImage2D(3553,i,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,o,t.mipmaps[0].data):qe.texSubImage2D(3553,i,e.x,e.y,o,a,t.image),0===i&&r.generateMipmaps&&qe.generateMipmap(3553),Se.unbindTexture()},this.copyTextureToTexture3D=function(e,t,r,i,n=0){if(K.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const s=e.max.x-e.min.x+1,o=e.max.y-e.min.y+1,a=e.max.z-e.min.z+1,l=Oe.convert(i.format),u=Oe.convert(i.type);let d;if(i.isDataTexture3D)Ee.setTexture3D(i,0),d=32879;else{if(!i.isDataTexture2DArray)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");Ee.setTexture2DArray(i,0),d=35866}qe.pixelStorei(37440,i.flipY),qe.pixelStorei(37441,i.premultiplyAlpha),qe.pixelStorei(3317,i.unpackAlignment);const h=qe.getParameter(3314),p=qe.getParameter(32878),c=qe.getParameter(3316),f=qe.getParameter(3315),g=qe.getParameter(32877),m=r.isCompressedTexture?r.mipmaps[0]:r.image;qe.pixelStorei(3314,m.width),qe.pixelStorei(32878,m.height),qe.pixelStorei(3316,e.min.x),qe.pixelStorei(3315,e.min.y),qe.pixelStorei(32877,e.min.z),r.isDataTexture||r.isDataTexture3D?qe.texSubImage3D(d,n,t.x,t.y,t.z,s,o,a,l,u,m.data):r.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),qe.compressedTexSubImage3D(d,n,t.x,t.y,t.z,s,o,a,l,m.data)):qe.texSubImage3D(d,n,t.x,t.y,t.z,s,o,a,l,u,m),qe.pixelStorei(3314,h),qe.pixelStorei(32878,p),qe.pixelStorei(3316,c),qe.pixelStorei(3315,f),qe.pixelStorei(32877,g),0===n&&i.generateMipmaps&&qe.generateMipmap(d),Se.unbindTexture()},this.initTexture=function(e){Ee.setTexture2D(e,0),Se.unbindTexture()},this.resetState=function(){J=0,Q=0,$=null,Se.reset(),je.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}I.prototype.isWebGLRenderer=!0}}]);